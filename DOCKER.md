# üê≥ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ Docker

## üìã –ß—Ç–æ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

‚úÖ `next.config.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `output: 'standalone'`  
‚úÖ `Dockerfile` - –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è production  
‚úÖ `.dockerignore` - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤  
‚úÖ `docker-compose.yml` - —É–¥–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è  

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `.env.local`):

```env
NEXT_PUBLIC_TELEGRAM_BOT_TOKEN=your_bot_token_here
NEXT_PUBLIC_TELEGRAM_ADMIN_CHAT_ID=your_admin_chat_id_here
LEADS_WEBHOOK_URL=
LEADS_WEBHOOK_TOKEN=
```

#### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3000`

---

## üåê –î–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ (–¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

Docker —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ (`0.0.0.0:3000:3000`). –ß—Ç–æ–±—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫ –º–æ–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∞–π—Ç:

#### 1. –£–∑–Ω–∞–π—Ç–µ IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

**macOS/Linux:**
```bash
# –£–∑–Ω–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å
ifconfig | grep "inet " | grep -v 127.0.0.1

# –ò–ª–∏ –ø—Ä–æ—â–µ:
ipconfig getifaddr en0  # macOS
hostname -I | awk '{print $1}'  # Linux
```

**Windows:**
```cmd
ipconfig
# –ù–∞–π–¥–∏—Ç–µ IPv4 –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 192.168.1.100)
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall

**macOS:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å firewall
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 3000
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /usr/local/bin/node
```

**Linux (ufw):**
```bash
# –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 3000
sudo ufw allow 3000/tcp
sudo ufw status
```

**Windows:**
- –û—Ç–∫—Ä–æ–π—Ç–µ "–ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä –ó–∞—â–∏—Ç–Ω–∏–∫–∞ Windows"
- –†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–æ—Ä—Ç 3000 –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

#### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (WiFi/LAN):**
- –î—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–π –∂–µ —Å–µ—Ç–∏
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://–í–ê–®_IP_–ê–î–†–ï–°:3000`
- –ù–∞–ø—Ä–∏–º–µ—Ä: `http://192.168.1.100:3000`

**–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π IP):**
- –ù—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π IP –∞–¥—Ä–µ—Å –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ port forwarding –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://–í–ê–®_–ü–£–ë–õ–ò–ß–ù–´–ô_IP:3000`

#### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç (—Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)
curl http://–í–ê–®_IP_–ê–î–†–ï–°:3000

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ (–µ—Å–ª–∏ 3000 –∑–∞–Ω—è—Ç)

–ï—Å–ª–∏ –ø–æ—Ä—Ç 3000 –∑–∞–Ω—è—Ç, –∏–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml`:

```yaml
ports:
  - "0.0.0.0:8080:3000"  # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç:–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç
```

–¢–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç: `http://–í–ê–®_IP:8080`

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Docker –Ω–∞–ø—Ä—è–º—É—é

#### 1. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑

```bash
docker build -t site-etalon .
```

#### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker run -d \
  -p 0.0.0.0:3000:3000 \
  -e NEXT_PUBLIC_TELEGRAM_BOT_TOKEN=your_token \
  -e NEXT_PUBLIC_TELEGRAM_ADMIN_CHAT_ID=your_chat_id \
  -v $(pwd)/data:/app/data \
  --name site-etalon \
  --restart unless-stopped \
  site-etalon
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `-p 0.0.0.0:3000:3000` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å–∞–π—Ç—É —á–µ—Ä–µ–∑ –≤–∞—à IP –∞–¥—Ä–µ—Å.

#### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker logs -f site-etalon
```

#### 4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker stop site-etalon
docker rm site-etalon
```

---

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### Docker Compose

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker-compose build --no-cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec web sh
```

### Docker –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—Ä–∞–∑–æ–≤
docker images

# –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞
docker rmi site-etalon

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it site-etalon sh
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker –æ–±—Ä–∞–∑–∞

### Multi-stage build:

1. **deps** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **builder** - —Å–±–æ—Ä–∫–∞ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **runner** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º

### –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ –æ–±—Ä–∞–∑:

- ‚úÖ –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ `/public`
- ‚úÖ Node.js runtime
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Alpine Linux

### –ß—Ç–æ –ù–ï –≤–∫–ª—é—á–µ–Ω–æ:

- ‚ùå –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
- ‚ùå node_modules (—Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- ‚ùå Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ùå –§–∞–π–ª—ã –∏–∑ `.dockerignore`

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `nextjs` (–Ω–µ root)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –Ω–∞ –±–∞–∑–µ Alpine Linux
- ‚úÖ –¢–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ environment

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Healthcheck

Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

### –õ–æ–≥–∏

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
docker-compose logs --tail=50

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs web
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs web

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose config
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "Cannot find module"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –±–µ–∑ –∫—ç—à–∞
docker-compose build --no-cache
docker-compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç 3000 —É–∂–µ –∑–∞–Ω—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `docker-compose.yml`:
```yaml
ports:
  - "8080:3000"  # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç:–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤–æ–∫—Ä—É–≥ `=`)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose restart`

---

## üìù Production deployment

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª —Å production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   docker-compose up -d --build
   ```

### –° Nginx (reverse proxy)

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx:

```nginx
server {
    listen 80;
    server_name etalon-penza.ru;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (`.env` –∏–ª–∏ —á–µ—Ä–µ–∑ `-e`)
- [ ] Telegram –±–æ—Ç —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω (–∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω –≤ docker-compose.yml)
- [ ] –ü–∞–ø–∫–∞ `data` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫)
- [ ] Production build –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ: `npm run build`

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–í–∞—à —Å–∞–π—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ Docker! üöÄ

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
docker-compose up -d --build
```

–°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000`

